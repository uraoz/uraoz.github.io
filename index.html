<head>
<script type="text/javascript">
var canvas, ctx, center_x, center_y, radius, bars, 
x_end, y_end, bar_height, bar_width,rotetion,backcolor,
frequency_array;
bars = 100;
backcolor = 360 * Math.random();
rotetion = 0;
bar_width = 4;
navigator.webkitGetUserMedia({audio:true}, function(stream){
  audioContext = new AudioContext();
  analyser = audioContext.createAnalyser();
  microphone = audioContext.createMediaStreamSource(stream);
  javascriptNode = audioContext.createScriptProcessor(1024, 1, 1);

  analyser.smoothingTimeConstant = 0.0;
  analyser.fftSize = 512;

  microphone.connect(analyser);
  analyser.connect(javascriptNode);
  javascriptNode.connect(audioContext.destination);
  canvas = document.getElementById("renderer");
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  ctx = canvas.getContext("2d");
  center_x = canvas.width / 2;
  center_y = canvas.height / 2;
  radius = 300;
  javascriptNode.onaudioprocess = function() {
    var frequency_array =  new Uint8Array(analyser.frequencyBinCount);
    analyser.getByteFrequencyData(frequency_array);
    var values = 0;

    var length = frequency_array.length;
    for (var i = 0; i < length; i++) {
      values += frequency_array[i];
    }
    var gradient = ctx.createLinearGradient(0,0,0,canvas.height);
    gradient.addColorStop(0,"hsl(" + backcolor + ", 100%, 50%)");
    gradient.addColorStop(1,"hsl(" + (backcolor-120) + ", 100%, 50%)");
    ctx.fillStyle = gradient;
    ctx.fillRect(0,0,canvas.width,canvas.height);
    
    //draw a circle
    ctx.beginPath();
    ctx.arc(center_x,center_y,radius,0,2*Math.PI);
    ctx.stroke();
    
    analyser.getByteFrequencyData(frequency_array);
    for(var i = 0; i < bars; i++){
        
        //divide a circle into equal parts
      rads = Math.PI * 2 / bars;
      
      bar_height = frequency_array[i]*0.7;
        
        // set coordinates
      x = center_x + Math.cos(rads * (i + rotetion)) * (radius);
      y = center_y + Math.sin(rads * (i + rotetion)) * (radius);
      x_end = center_x + Math.cos(rads * (i + rotetion))*(radius + bar_height);
      y_end = center_y + Math.sin(rads * (i + rotetion))*(radius + bar_height);
      var lineColor = "rgb(" + frequency_array[i] + ", " + frequency_array[i] + ", " + 100+i + ")";
      ctx.strokeStyle = lineColor;
      ctx.lineWidth = bar_width;
      ctx.beginPath();
      ctx.moveTo(x,y);
      ctx.lineTo(x_end,y_end);
      ctx.stroke();
      
    }
    rotetion+=0.02;
  }
  }, function(e){ console.log(e); });
</script>
  <canvas id="renderer"></canvas>
</head>